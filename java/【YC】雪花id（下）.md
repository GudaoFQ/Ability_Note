## 针对雪花ID的问题解决
> 使用对应的分布式ID框架：Butterfly

### 雪花ID存在的问题
* 时间回拨问题 
* 机器id的分配和回收问题 
* 机器id的上限问题

### Butterfly 简介
* Butterfly（蝴蝶）是一个超高性能的发号器框架。起名Butterfly是用世界上没有完全相同的蝴蝶翅膀来表示该算法的唯一性。框架通过引入多种新的方案不仅解决了雪花算法存在的所有问题，而且还能够提供比雪花算法更高的性能。在单机版QPS理论值为51.2(w/s)这种情况下，新的方案在一些机器上可达 1000(w/s) 甚至更高。
* 其中业内针对前两个问题都有个自己的解决方式，但是都不是很完美，或者说没有完全解决。我们这里从新的思路出发，通过改造雪花算法以及其他相关方式彻底解决了以上的三个问题。该方案算是对雪花算法比较完美的一种实现方式。

#### 解决思路
* 时间回拨问题
  * 启动时间戳采用的是“历史时间”，每次请求只增序列值，序列值增满，然后“历史时间”增1，序列值重新计算
* 机器id分配和回收
  * zookeeper和db。理论上分配方案zk是通过哈希和扩容机器，而db是通过查找机制
  * 回收方案，zk采用的是永久节点，节点中存储下次过期时间，客户端定时上报（设置心跳），db是添加过期时间字段，查找时候判断过期字段
* 机器id上限
  * 采用将改造版雪花+zookeeper分配id方案作为服务端的节点，客户端采用双Buffer+异步获取提高性能，服务端采用每次请求时间戳增1